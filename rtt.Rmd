
The slope of root-to-tip plots over time provide an estimate of the substitution rate.
A lineage with a steeper positive slope than average for SARS-CoV-2 is accumulating mutations at a faster pace, while a lineage that exhibits a jump up (a shift in intercept but not slope) has accumulated more than expected numbers of mutations in a transient period of time (similar to what we saw with Alpha when it first appeared in the UK).

```{r, dpi=300}

get.tipnames <- function(tip.label) {
  sapply(tip.label, function(x) {
    tokens <- strsplit(x, "_")[[1]]
    ntok <- length(tokens)
    paste(tokens[1:(ntok-2)], collapse='_')
  })
}

source("scripts/fit-rtt.R")
fit1 <- fit.rtt(paste0(params$datadir, "/aligned_allSeqs_sample1.rtt.nwk"), plot=TRUE)

```


```{r}
fit2 <- fit.rtt(paste0(params$datadir,"/aligned_allSeqs_sample2.rtt.nwk"), plot=FALSE)
fit3 <- fit.rtt(paste0(params$datadir,"/aligned_allSeqs_sample3.rtt.nwk"), plot=FALSE)
```


## Molecular clock estimates (based on three independent subsamples)

Here we show the estimate of the substitution rate for 3 independent subsamples of different variants of interest, with their 95% confidence interval.

```{r}

if(!is.null(fit1)){
  est1 <- get.ci(fit1); est1$rep <- 'Rep1'
  est2 <- get.ci(fit2); est2$rep <- 'Rep2'
  est3 <- get.ci(fit3); est3$rep <- 'Rep3'
  sec.frame <- rbind(est1, est2, est3)
  sec.frame$est[sec.frame$est < 0] <- 0
  sec.frame$lower.95[sec.frame$lower.95 < 0] <- 0
  sec.frame=sec.frame[sec.frame$Lineage != "Recombinants",]
  
  pal <- VOCVOI$color
  names(pal) <- VOCVOI$name
  pal["other"] <- "white"
    
  ggplot(sec.frame, aes(x=Lineage, y=est, group=rep)) + 
    geom_bar(stat="identity", color="black", aes(fill=Lineage), position='dodge') + 
    scale_fill_manual(values=pal) + 
    theme(axis.text.x = element_text(size=9, angle=45, hjust=1, vjust=0.95),
          legend.position='none', panel.grid.major=element_line(colour="grey90")) + 
    geom_errorbar(aes(ymin=lower.95, ymax=upper.95), width=.7,
                  position=position_dodge(1)) +
    labs(y="Substitutions / Genome / Day",
         x="Lineage", fill="Subsample")
}

```