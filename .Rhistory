df_PTs <-data.frame(divisions=metasub1$province) #make df for heatmaps
rownames(df_PTs) <- metasub1$GISAID
listPTs <- unique(metasub1$Location)
listPTs <- listPTs[order(listPTs)]
listPTs
listPTs <- unique(metasub1$province)
listPTs
listPTs <- listPTs[order(listPTs)]
listPTs <- listPTs["NA"]
listPTs
listPTs <- unique(metasub1$province)
listPTs <- listPTs[order(listPTs)]
listPTs
listPTs <- listPTs[-"NA"]
listPTs <- listPTs[-11]
listPTs
getpal2 <- colorRampPalette(brewer.pal(10, "Spectral")) #"Set3
pal2 <- getpal2(length(listPTs))
names(pal2) <- listPTs
listPTs
mrdate <- max(na.omit(metasub1$Date))
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("label", "Variant"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = Variant), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogp, values = pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
ttree_sub1
head(metasub1)
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = Variant), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogp, values = pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogp, values = pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
listpangogp
pal
ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(values = pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(values = pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
listpangop
listpangogp
listpangogp<-unique(metasub1$pango.group)
listpangogp<-order(listpangogp)
listpangogp
listpangogp<-unique(metasub1$pango.group)
listpangogp
listpangogp<-order[listpangogp]
listpangogp<-sort(listpangogp)
listpangogp
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogps,values = pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogp,values = pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_brewer("pango.group",palette="Spectral")+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
ttree_sub1
ttree_sub1$tip.label
metasub1$EPI
MLtree_sub1 <- read.tree("./data_needed/iqtree_trimmed_noBA2.nwk")
ttree_sub1 <- read.tree("./data_needed/subsample_V1_timetree.nwk")
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_brewer("pango.group",palette="Spectral")+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogp,values="pal")+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
pal
listpangogp
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogp,values=pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p1
df_PTs
head(df_PTs)
plot1 <- gheatmap(p1, df_PTs[, "divisions", drop = FALSE], width= 0.1, color = F, colnames = F, legend_title = F) +
scale_fill_manual(breaks=listPTs, values = pal2)
plot1
rownames(df_PTs) <- metasub1$EPI
listPTs <- unique(metasub1$province)
listPTs <- listPTs[order(listPTs)]
listPTs <- listPTs[-11] #remove hubei
getpal2 <- colorRampPalette(brewer.pal(10, "Spectral")) #"Set3
pal2 <- getpal2(length(listPTs))
names(pal2) <- listPTs
plot1 <- gheatmap(p1, df_PTs[, "divisions", drop = FALSE], width= 0.1, color = F, colnames = F, legend_title = F) +
scale_fill_manual(breaks=listPTs, values = pal2)
plot1
MLtree_sub1$tip.label
p2 <- ggtree(MLtree_sub1) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = Variant), size=0.5)+
scale_color_manual(breaks=listpangogp, values = pal)+
#ggtitle("ML tree - Canada - subsample1, n = 8K")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p2
p2 <- ggtree(MLtree_sub1) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+
scale_color_manual(breaks=listpangogp, values = pal)+
#ggtitle("ML tree - Canada - subsample1, n = 8K")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
p2
plot2 <- gheatmap(p2, df_PTs[, "divisions", drop = FALSE], width= 0.1, color = F, colnames = F, legend_title = F) +
scale_fill_manual(breaks=listPTs, values = pal2)
plot2
table(metasub1$pango.group)
rooted <- read.tree('./data_needed/iqtree_trimmed_noBA2.nwk')
metadataRTT <- read.delim("./data_needed/subsampling_metadata_V1.tsv")
rooted$tip.label
index1<-match(names,metadataRTT$Date)
names
names<-rooted$tip.label
name_list<-rooted$tip.label
index1<-match(name_list,metadataRTT$Date)
index1
name_list
index1<-match(name_list,metadataRTT$EPI)
index1
date <- metadataRTT$Date[index1]
date
pg <- metadataRTT$pango.group[index1]
blobs <- function(x, y, col, cex=1) {
points(x, y, pch=21, cex=cex)
points(x, y, bg=col, col=rgb(0,0,0,0), pch=21, cex=cex)
}
dlines <- function(x, y, col) {
lines(x, y, lwd=2.5)
lines(x, y, col=col)
}
pal
# total branch length from root to each tip
div <- node.depth.edgelength(rooted)[1:Ntip(rooted)]
par(mar=c(5,5,0,1))
plot(tip.dates, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
plot(dates, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
date
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
div
date
format(date)
date<-as.Date(date)
date
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(tip.dates), max(tip.dates), length.out=5), unit="months")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
axis(side=1, at=xx, label=format(xx, "%b %Y"), cex.axis=0.6)
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
axis(side=1, at=xx, label=format(xx, "%b %Y"), cex.axis=0.6)
blobs(date[pg=='other'], div[pg=='other'], col='grey', cex=0.8)
pg
pg <- metadataRTT$pango.group[index1]
pg
metadataRTT$Variant
metadataRTT <- metasub1
name_list<-rooted$tip.label
index1<-match(name_list,metadataRTT$EPI)
date <- metadataRTT$Date[index1]
pg <- metadataRTT$pango.group[index1]
date<-as.Date(date)
pg
pal
names(pal)
voc<-names(pal)
par(mar=c(5,5,0,1))
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
date
min(date)
max(date)
name_list<-rooted$tip.label
index1<-match(name_list,metadataRTT$EPI)
date <- metadataRTT$Date[index1]
pg <- metadataRTT$pango.group[index1]
date<-as.Date(date)
# total branch length from root to each tip
div <- node.depth.edgelength(rooted)[1:Ntip(rooted)]
blobs <- function(x, y, col, cex=1) {
points(x, y, pch=21, cex=cex)
points(x, y, bg=col, col=rgb(0,0,0,0), pch=21, cex=cex)
}
dlines <- function(x, y, col) {
lines(x, y, lwd=2.5)
lines(x, y, col=col)
}
par(mar=c(5,5,0,1))
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
min(date)
date
class(date)
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
max(date)
min(date)
test<-c("2022-12-01","2022-11-01","2022-10-01")
test<-as.Date(test)
min(test)
date
data<-as.Date(date)
min(date)
unique(date)
head(metasub1)
unique(metadataRTT$Date)
index1
name_list[1]
name_list[2]
date[1]
pg[1]
rooted <- read.tree('./data_needed/iqtree_trimmed_noBA2.nwk')
metadataRTT <- metasub1
voc<-names(pal)
name_list<-rooted$tip.label
name_list[1]
match(name_list[1],metadataRTT)
metasub1 <- read.delim( "./data_needed/subsampling_metadata_V1.tsv")
MLtree_sub1 <- read.tree("./data_needed/iqtree_trimmed_noBA2.nwk")
ttree_sub1 <- read.tree("./data_needed/subsample_V1_timetree.nwk")
### needed for plotting
pango_frame<-metaCANall[c("Pango_lineage","pango.group")]
pango_col<-pango_frame %>% distinct()#make a lookup table for all lineages to pango.group
metasub1<-merge(metasub1,pango_col,by.x="Variant",by.y="Pango_lineage",all.y=FALSE)
head(metasub1)
metasub1 <- read.delim( "./data_needed/subsampling_metadata_V1.tsv")
MLtree_sub1 <- read.tree("./data_needed/iqtree_trimmed_noBA2.nwk")
ttree_sub1 <- read.tree("./data_needed/subsample_V1_timetree.nwk")
### needed for plotting
pango_frame<-metaCANall[c("Pango_lineage","pango.group")]
pango_col<-pango_frame %>% distinct()#make a lookup table for all lineages to pango.group
metasub1<-merge(metasub1,pango_col,by.x="Variant",by.y="Pango_lineage",all.y=FALSE,all.x=TRUE)
head(metasub1)
### metadata and trees
metasub1 <- read.delim( "./data_needed/subsampling_metadata_V1.tsv")
head(metasub1)
pango_frame<-metaCANall[c("Pango_lineage","pango.group")]
pango_col<-pango_frame %>% distinct()#make a lookup table for all lineages to pango.group
metasub1<-merge(metasub1,pango_col,by.x="Variant",by.y="Pango_lineage",all.y=FALSE,all.x=TRUE)
head(metasub1)
match(name_list[1],metasub1$EPI)
division_frame<-metaCANall[c("Virus_name","province")]
metasub1<-merge(metasub1,division_frame,by.x="GISAID",by.y="Virus_name",all.y=FALSE,all.x=TRUE)
listpangogp<-unique(metasub1$pango.group)
listpangogp<-sort(listpangogp)
#division colours for heatmap
df_PTs <-data.frame(divisions=metasub1$province) #make df for heatmaps
rownames(df_PTs) <- metasub1$EPI #needs row names for heatmaps
metasub1<-merge(metasub1,division_frame,by.x="GISAID",by.y="Virus_name",all.y=FALSE,all.x=TRUE)
metasub1 <- read.delim( "./data_needed/subsampling_metadata_V1.tsv")
MLtree_sub1 <- read.tree("./data_needed/iqtree_trimmed_noBA2.nwk")
ttree_sub1 <- read.tree("./data_needed/subsample_V1_timetree.nwk")
### needed for plotting
pango_frame<-metaCANall[c("Pango_lineage","pango.group")]
pango_col<-pango_frame %>% distinct()#make a lookup table for all lineages to pango.group
metasub1<-merge(metasub1,pango_col,by.x="Variant",by.y="Pango_lineage",all.y=FALSE,all.x=TRUE)
division_frame<-metaCANall[c("Virus_name","province")]
metasub1<-merge(metasub1,division_frame,by.x="GISAID",by.y="Virus_name",all.y=FALSE,all.x=TRUE)
listpangogp<-unique(metasub1$pango.group)
listpangogp<-sort(listpangogp)
#division colours for heatmap
df_PTs <-data.frame(divisions=metasub1$province) #make df for heatmaps
rownames(df_PTs) <- metasub1$EPI #needs row names for heatmaps
match(name_list[1],metadataRTT)
metasub1 <- read.delim( "./data_needed/subsampling_metadata_V1.tsv")
MLtree_sub1 <- read.tree("./data_needed/iqtree_trimmed_noBA2.nwk")
ttree_sub1 <- read.tree("./data_needed/subsample_V1_timetree.nwk")
### needed for plotting
pango_frame<-metaCANall[c("Pango_lineage","pango.group")]
pango_col<-pango_frame %>% distinct()#make a lookup table for all lineages to pango.group
metasub1<-merge(metasub1,pango_col,by.x="Variant",by.y="Pango_lineage",all.y=FALSE,all.x=TRUE)
match(name_list[1],metadataRTT)
metasub1 <- read.delim( "./data_needed/subsampling_metadata_V1.tsv")
dim(metasub1)
pango_frame<-metaCANall[c("Pango_lineage","pango.group")]
pango_col<-pango_frame %>% distinct()#make a lookup table for all lineages to pango.group
metasub1<-merge(metasub1,pango_col,by.x="Variant",by.y="Pango_lineage",all.y=FALSE,all.x=TRUE)
dim(metasub1)
division_frame<-metaCANall[c("Virus_name","province")]
metasub1<-merge(metasub1,division_frame,by.x="GISAID",by.y="Virus_name",all.y=FALSE,all.x=TRUE)
dim(metasub1)
head(metasub1)
match(name_list[1],metasub1$EPI)
listpangogp<-unique(metasub1$pango.group)
listpangogp<-sort(listpangogp)
#division colours for heatmap
df_PTs <-data.frame(divisions=metasub1$province) #make df for heatmaps
rownames(df_PTs) <- metasub1$EPI #needs row names for heatmaps
#division colours
listPTs <- unique(metasub1$province)
listPTs <- listPTs[order(listPTs)]
listPTs <- listPTs[-11] #remove hubei
getpal2 <- colorRampPalette(brewer.pal(10, "Spectral")) #"Set3
pal2 <- getpal2(length(listPTs))
names(pal2) <- listPTs
mrdate <- max(na.omit(metasub1$Date))
p1 <- ggtree(ttree_sub1, mrsd = as.Date(mrdate)) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+ #, shape= lab
scale_color_manual(breaks=listpangogp,values=pal)+
#ggtitle("Time tree - Canada - downsample1")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
plot1 <- gheatmap(p1, df_PTs[, "divisions", drop = FALSE], width= 0.1, color = F, colnames = F, legend_title = F) +
scale_fill_manual(breaks=listPTs, values = pal2)
### diversity ML tree
p2 <- ggtree(MLtree_sub1) %<+% metasub1[,c("EPI", "pango.group"), drop=FALSE] +
geom_tippoint(color="black", size=1)+
geom_tippoint(aes(color = pango.group), size=0.5)+
scale_color_manual(breaks=listpangogp, values = pal)+
#ggtitle("ML tree - Canada - subsample1, n = 8K")+
coord_cartesian(clip = 'off') + theme_tree2(plot.margin=margin(6, 40, 6, 6))+
guides(color = guide_legend(override.aes = list(size = 4) ) )+
theme(legend.position = "right", legend.title = element_blank(), legend.text = element_text(size =12))
plot2 <- gheatmap(p2, df_PTs[, "divisions", drop = FALSE], width= 0.1, color = F, colnames = F, legend_title = F) +
scale_fill_manual(breaks=listPTs, values = pal2)
rooted <- read.tree('./data_needed/iqtree_trimmed_noBA2.nwk')
metadataRTT <- metasub1
voc<-names(pal)
name_list<-rooted$tip.label
index1<-match(name_list,metadataRTT$EPI)
index1
date <- metadataRTT$Date[index1]
pg <- metadataRTT$pango.group[index1]
date<-as.Date(date)
# total branch length from root to each tip
div <- node.depth.edgelength(rooted)[1:Ntip(rooted)]
blobs <- function(x, y, col, cex=1) {
points(x, y, pch=21, cex=cex)
points(x, y, bg=col, col=rgb(0,0,0,0), pch=21, cex=cex)
}
dlines <- function(x, y, col) {
lines(x, y, lwd=2.5)
lines(x, y, col=col)
}
par(mar=c(5,5,0,1))
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
axis(side=1, at=xx, label=format(xx, "%b %Y"), cex.axis=0.6)
blobs(date[pg=='other'], div[pg=='other'], col='grey', cex=0.8)
fit0 <- rlm(div[pg=='other'] ~ date[pg=='other'])
abline(fit0, col='gray50')
fits <- list(other=fit0)
for (i in 1:length(vocs)) {
variant <- vocs[i]
x <- date[pg==pango.group]
if (all(is.na(x))) next
y <- div[pg==pango.group]
blobs(x, y, col=pal[i], cex=0.8)
fit <- rlm(y ~ x)
dlines(fit$x[,2], predict(fit), col=pal[i])
fits[[variant]] <- fit
}
vocs<-names(pal)
for (i in 1:length(vocs)) {
variant <- vocs[i]
x <- date[pg==pango.group]
if (all(is.na(x))) next
y <- div[pg==pango.group]
blobs(x, y, col=pal[i], cex=0.8)
fit <- rlm(y ~ x)
dlines(fit$x[,2], predict(fit), col=pal[i])
fits[[variant]] <- fit
}
pg
pal
voc[1]
voc[2]
head(date)
pg
for (i in 1:length(vocs)) {
variant <- vocs[i]
x <- date[pg==variant]
if (all(is.na(x))) next
y <- div[pg==variant]
blobs(x, y, col=pal[i], cex=0.8)
fit <- rlm(y ~ x)
dlines(fit$x[,2], predict(fit), col=pal[i])
fits[[variant]] <- fit
}
par(mar=c(5,5,0,1))
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
axis(side=1, at=xx, label=format(xx, "%b %Y"), cex.axis=0.6)
blobs(date[pg=='other'], div[pg=='other'], col='grey', cex=0.8)
fit0 <- rlm(div[pg=='other'] ~ date[pg=='other'])
abline(fit0, col='gray50')
fits <- list(other=fit0)
for (i in 1:length(vocs)) {
variant <- vocs[i]
x <- date[pg==variant]
if (all(is.na(x))) next
y <- div[pg==variant]
blobs(x, y, col=pal[i], cex=0.8)
fit <- rlm(y ~ x)
dlines(fit$x[,2], predict(fit), col=pal[i])
fits[[variant]] <- fit
}
legend(x=min(tip.dates), y=max(div), legend=vocs, pch=21, pt.bg=pal, bty='n', cex=0.8)
legend(x=min(dates), y=max(div), legend=vocs, pch=21, pt.bg=pal, bty='n', cex=0.8)
par(mar=c(5,5,0,1))
plot(date, div, type='n', las=1, cex.axis=0.6, cex.lab=0.7, bty='n',
xaxt='n', xlab="Sample collection date", ylab="Divergence from root")
xx <- floor_date(seq(min(date), max(date), length.out=5), unit="months")
axis(side=1, at=xx, label=format(xx, "%b %Y"), cex.axis=0.6)
blobs(date[pg=='other'], div[pg=='other'], col='grey', cex=0.8)
fit0 <- rlm(div[pg=='other'] ~ date[pg=='other'])
abline(fit0, col='gray50')
fits <- list(other=fit0)
for (i in 1:length(vocs)) {
variant <- vocs[i]
x <- date[pg==variant]
if (all(is.na(x))) next
y <- div[pg==variant]
blobs(x, y, col=pal[i], cex=0.8)
fit <- rlm(y ~ x)
dlines(fit$x[,2], predict(fit), col=pal[i])
fits[[variant]] <- fit
}
legend(x=min(date), y=max(div), legend=vocs, pch=21, pt.bg=pal, bty='n', cex=0.8)
ci <- lapply(fits, confint.default)
kable(data.frame(
n=sapply(fits, function(f) nrow(f$x)),
est=29970*sapply(fits, function(f) f$coef[2]),
lower.95=29970*sapply(ci, function(f) f[2,1]),
upper.95=29970*sapply(ci, function(f) f[2,2])
),
col.names = c("Number of genomes", "Estimate", "Lower 95% CI", "Upper 95% CI"),
format="html", align="rrrr", caption="Molecular clock rates (subs/genome/day)",
format.args = list(scientific = FALSE), digits=4, table.attr = "style='width:100%;'")
len(date)
length(date)
